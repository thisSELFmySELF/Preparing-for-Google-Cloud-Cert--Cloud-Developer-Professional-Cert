
<!DOCTYPE html>
<html lang='en'>
<head>
<title>Using a Global Load Balancer with Cloud Run [APPRUN] | Qwiklabs</title>
<meta name="action-cable-url" content="/cable" />
<script>
//<![CDATA[
window.gon={};gon.deployment="googlecoursera-run";
//]]>
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-5XSKHDX");
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-b1b28b59480cca2ab0c23485f64ba2ec8893bdc9.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-484f429ecd41bc910509948cecaf71d98c510234.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-644b7af44e10b6334d7881042d33e7eac427c3b8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-011e84c80a51010837f8d7868d0972aebf80b2b1.js"></script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="ppEflfbGr2TciOeru93SdUhxIccP2TB+yqr/17NyAcP+KEcQyo792D798cyEgLhDMXMecLLzjJdoaHKeL2W/gg==" />
<meta content='width=device-width, initial-scale=1.0, user-scalable=yes' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:0,&quot;variant&quot;:&quot;original&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:12197799,&quot;experimentIds&quot;:[&quot;barker&quot;,&quot;community_forum&quot;,&quot;enforce_codebuild_verdicts&quot;,&quot;used_in&quot;,&quot;content_provider_admin&quot;,&quot;program_announcements&quot;,&quot;organization_announcements&quot;,&quot;organization_learning_plans&quot;,&quot;course_upgrade&quot;,&quot;show_annual_purchase_now&quot;,&quot;oauth_risc_shutoff&quot;,&quot;program_learning_assignment&quot;,&quot;teams&quot;,&quot;peer_assignment&quot;,&quot;chat_off_for_signed_out_users&quot;,&quot;canonical_domain_redirect&quot;,&quot;alexandria_show_bundle_errors&quot;,&quot;search_updates&quot;]}' name='help-api-product-data'>
<meta content='{&quot;groupIds&quot;:[&quot;non_suadmins&quot;,&quot;students&quot;,&quot;non_organization&quot;,&quot;non_program&quot;]}' name='help-api-custom-data'>
<meta content='Cloud Run allows you to specify which revisions should receive traffic and to specify traffic percentages that are received by a revision.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Using a Global Load Balancer with Cloud Run [APPRUN] | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='Cloud Run allows you to specify which revisions should receive traffic and to specify traffic percentages that are received by a revision.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<meta property="og:url" content="https://googlecoursera.qwiklabs.com/focuses/32770694?parent=lti_session" /><link href="https://googlecoursera.qwiklabs.com/focuses/32770694?parent=lti_session" rel="canonical" />
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>
<link href='/favicon-32.png' rel='shortcut icon' type='image/x-icon'>


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons|Google+Sans+Text:400,500,700" media="screen" />

<link rel="stylesheet" href="https://cdn.qwiklabs.com/assets/application-2bce1f34bff374bb8e1de389ce3467c39fc4868b.css" media="all" />
<link rel="stylesheet" href="https://www.gstatic.com/glue/cookienotificationbar/cookienotificationbar.min.css" media="screen" />


<style>
  :root {
    --primary-text-on-surface-color: #1a73e8;
    --primary-text-on-surface-color-dark: #1568d6;
    --primary-text-on-surface-color-darker: #135ec1;
    --primary-text-on-surface-color-darkest: #1154ac;
    --primary-surface-color: #1a73e8;
    --primary-surface-color-rgb: 26,115,232;
    --primary-surface-color-light: #d1e3fa;
    --primary-surface-color-lightest: #e8f1fd;
    --text-on-primary-color: #ffffff;
    --accent-text-on-surface-color: #f29900;
    --accent-surface-color: #f9ab00;
    --accent-surface-color-rgb: 249,171,0;
    --accent-surface-color-light: #ffefcc;
    --text-on-accent-color: #202124;
  }
</style>



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<div class='header-container'>
<div class='header'>
<ql-toolbar jumpEnabled>
<div class='header__title' slot='title'>
<ql-icon-button label="Back" href="https://www.coursera.org/" id="1fb8e2c661efefc6" target="_self" tip="Back">arrow_back</ql-icon-button>
<h1 class='ql-title-medium'>Using a Global Load Balancer with Cloud Run [APPRUN]</h1>
</div>
<div class='header__actions' slot='action'>
<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>
<ql-icon-button class='mobile-hide' icon='help_outline' id='help-menu-button' label='Open help menu' tip='Help'></ql-icon-button>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item data-analytics-action='opened_help' data-analytics-label='lab' label='Help Center' onclick='hallofmirrors.helpService.startHelp({&quot;productData&quot;:{&quot;userId&quot;:12197799},&quot;context&quot;:&quot;lab&quot;})'></ql-menu-item>
<ql-menu-item href='mailto:support@qwiklabs.com' label='Email support'></ql-menu-item>
<ql-menu-item label='Chat support' onClick='ql.chat.open()'></ql-menu-item>
</ql-menu>

<ql-icon-button class='mobile-hide' icon='language' id='language' label='Select your language preference' tip='Language'></ql-icon-button>
<ql-menu for='language'>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ar' href='/focuses/32770694?locale=ar&amp;parent=lti_session' label='العربية‬‎' lang='ar'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='de' href='/focuses/32770694?locale=de&amp;parent=lti_session' label='Deutsch' lang='de'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='en' href='/focuses/32770694?locale=en&amp;parent=lti_session' label='English' lang='en'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='es' href='/focuses/32770694?locale=es&amp;parent=lti_session' label='español (Latinoamérica)' lang='es'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr' href='/focuses/32770694?locale=fr&amp;parent=lti_session' label='français' lang='fr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr_CA' href='/focuses/32770694?locale=fr_CA&amp;parent=lti_session' label='français (Canada)' lang='fr-CA'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='he' href='/focuses/32770694?locale=he&amp;parent=lti_session' label='עברית' lang='he'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='id' href='/focuses/32770694?locale=id&amp;parent=lti_session' label='bahasa Indonesia' lang='id'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='it' href='/focuses/32770694?locale=it&amp;parent=lti_session' label='Italiano' lang='it'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ja' href='/focuses/32770694?locale=ja&amp;parent=lti_session' label='日本語' lang='ja'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ko' href='/focuses/32770694?locale=ko&amp;parent=lti_session' label='한국어' lang='ko'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pl' href='/focuses/32770694?locale=pl&amp;parent=lti_session' label='Polski' lang='pl'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_BR' href='/focuses/32770694?locale=pt_BR&amp;parent=lti_session' label='português (Brasil)' lang='pt-BR'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_PT' href='/focuses/32770694?locale=pt_PT&amp;parent=lti_session' label='português (Portugal)' lang='pt-PT'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ru' href='/focuses/32770694?locale=ru&amp;parent=lti_session' label='русский' lang='ru'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='tr' href='/focuses/32770694?locale=tr&amp;parent=lti_session' label='Türkçe' lang='tr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='uk' href='/focuses/32770694?locale=uk&amp;parent=lti_session' label='український' lang='uk'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh' href='/focuses/32770694?locale=zh&amp;parent=lti_session' label='简体中文' lang='zh'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh_TW' href='/focuses/32770694?locale=zh_TW&amp;parent=lti_session' label='繁體中文' lang='zh-TW'></ql-menu-item>
</ql-menu>


<ql-icon-button id='my_account' label='My account' tip='My account'>
<ql-avatar src='https://lh3.googleusercontent.com/a/ACg8ocI6s7UhNvX_oCOJMPhLJPmqhqIgwu_5AK0t7wpjF-5jmQo=s320-c'></ql-avatar>
</ql-icon-button>
<ql-menu for='my_account' id='my_account_menu' style='max-height: 640px'>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh3.googleusercontent.com/a/ACg8ocI6s7UhNvX_oCOJMPhLJPmqhqIgwu_5AK0t7wpjF-5jmQo=s320-c'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-title-medium'>Justin Ho</h4>
<p class='ql-body-medium text--light'>cliffdove@gmail.com</p>
<p class='ql-body-medium text--light'>
</p>
<a class="text--green ql-title-small" href="/my_account/payments"><ql-chip positive>
0 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a target="_blank" class="ql-label-medium text--light" href="/privacy_policy">Privacy</a>
<span class='ql-label-medium text--light l-mls l-mrs'>&middot;</span>
<a class="ql-label-medium text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</ql-toolbar>

</div>
</div>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class="custom-logo">Qwiklabs</div>
</div>
<nav class='ql-sidenav'>
<ql-sidenav-item href='/' icon='home' label='Home'></ql-sidenav-item>

<ql-sidenav-item href='/catalog' icon='school' label='Catalog'></ql-sidenav-item>

<ql-sidenav-item href='/profile' icon='event_note' label='Profile'></ql-sidenav-item>

</nav>

</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main' id='jump-content'>
<div class='l-main-wrapper' id='main-wrapper'>




<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Using a Global Load Balancer with Cloud Run [APPRUN]&quot;,&quot;lab_name&quot;:&quot;Using a Global Load Balancer with Cloud Run [APPRUN]&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;googlecoursera-run&quot;}' data-credits='0.0' data-focus-id='32770694' data-lab-billing-limit='0.0' data-lab-duration='3600' data-parent='lti_session' data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:3600}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
             grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                  var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
          var element = document.getElementById(id);
          if (element !== null) element.value = token;
        }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div aria-live='polite' class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='lab-content-container'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message' role='alert'></p>
<ql-icon-button class='alert__close js-alert-close' icon='clear'></ql-icon-button>
<iframe class='l-ie-iframe-fix' tabindex='-1'></iframe>
</div>
<div class='lab-content__renderable-instructions js-lab-content'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Using a Global Load Balancer with Cloud Run [APPRUN]
</h1>
<div class='lab-preamble__details ql-title-medium'>
<span>1 hour</span>
<span>Free</span>
<div class='lab__rating'>
<a aria-label="Lab Reviews" href="/focuses/32770694/reviews?parent=lti_session"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.576'></div>

</a></div>
</div>
</div>
<div class='lab-outline-place-holder'></div>

<div class='markdown-lab-instructions js-markdown-instructions' id='markdown-lab-instructions'>

<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>
<h2 id="step1">Overview</h2>
<p><img alt="The External HTTP(S) Load Balancer architecture" src="https://cdn.qwiklabs.com/CiYV50aWUQkjVYPneolGH9XQJP5AoG%2F6PnoGp9Mrc%2BM%3D"></p>
<p>Serverless Network Endpoint Groups (NEGs) allow you to use Google Cloud serverless apps with external HTTP(S) Load Balancing. After you have configured a load balancer with the serverless NEG backend, requests to the load balancer are routed to the serverless app backend.</p>
<p>In this lab you will learn how to set up and use an HTTP global load balancer with Cloud Run.</p>
<h3>Objectives</h3>
<p>In this lab, you learn to:</p>
<ul>
<li>
<p>Enable the Cloud Run API.</p>
</li>
<li>
<p>Create and deploy a sample application in Cloud Run.</p>
</li>
<li>
<p>Configure a Serverless Network Engpoint Group (NEG).</p>
</li>
<li>
<p>Create a global load balancer with a serverless NEG backend.</p>
</li>
<li>
<p>Route requests for the sample application through the global load balancer.</p>
</li>
</ul>
<h3>Prerequisites</h3>
<p>These labs are based on intermediate knowledge of Google Cloud. While the steps required are covered in the content, it would be helpful to have familiarity with any of the following products:</p>
<ul>
<li>
<p>HTTP load balancer</p>
</li>
<li>
<p>Cloud Run</p>
</li>
</ul>
<h2 id="step2">Setup and requirements</h2>
<h4>Before you click the Start Lab button</h4>
<ql-warningbox><strong>Note: Read these instructions.</strong>
<p></p>
Labs are timed and you cannot pause them. The timer, which starts when you click <b>Start Lab</b>, shows how long Google Cloud resources will be made available to you.</ql-warningbox>
<p>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<ql-warningbox><strong>Note: </strong>If you already have your own personal Google Cloud account or project, do not use it for this lab.</ql-warningbox>
<ql-infobox><strong>Note: </strong>If you are using a Pixelbook, open an Incognito window to run this lab.</ql-infobox>
<h4>How to start your lab and sign in to the Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Credentials panel" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Choose an account</strong> page.</p>
<ql-infobox><strong>Note: </strong>Open the tabs in separate windows, side-by-side.</ql-infobox>
</li>
<li>
<p>On the Choose an account page, click <strong>Use Another Account</strong>. The Sign in page opens.</p>
<p><img alt="Choose an account dialog box with Use Another Account option highlighted " src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D"></p>
</li>
<li>
<p>Paste the username that you copied from the Connection Details panel. Then copy and paste the password.</p>
</li>
</ol>
<ql-warningbox><strong>Note: </strong>You must use the credentials from the Connection Details panel. Do not use your Google Cloud Skills Boost credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</ql-warningbox>
<ol start="5">
<li>Click through the subsequent pages:</li>
</ol>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
<p>After a few moments, the Cloud console opens in this tab.</p>
<ql-infobox><strong>Note: </strong>You can view the menu with a list of Google Cloud Products and Services by clicking the <b>Navigation menu</b> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</ql-infobox>
<h3>Activate Google Cloud Shell</h3>
<p>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</p>
<p>Google Cloud Shell provides command-line access to your Google Cloud resources.</p>
<ol>
<li>
<p>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</p>
<p><img alt="Highlighted Cloud Shell icon" src="https://cdn.qwiklabs.com/00tA48qOVOyHrSa1DA7LwccfwQ9Z%2BE6dkvQ1MYPHzhQ%3D"></p>
</li>
<li>
<p>Click <strong>Continue</strong>.</p>
</li>
</ol>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Project ID highlighted in the Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><strong>gcloud</strong> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<ul>
<li>You can list the active account name with this command:</li>
</ul>
<ql-code-block language="plaintext">
gcloud auth list
</ql-code-block>
<p><strong>Output:</strong></p>
<ql-code-block output="">
Credentialed accounts:
 - @.com (active)
</ql-code-block>
<p><strong>Example output:</strong></p>
<ql-code-block output="">
Credentialed accounts:
 - google1623327_student@qwiklabs.net
 </ql-code-block>
<ul>
<li>You can list the project ID with this command:</li>
</ul>
<ql-code-block language="plaintext">
gcloud config list project
</ql-code-block>
<p><strong>Output:</strong></p>
<ql-code-block output="">
[core]
project = 
</ql-code-block>
<p><strong>Example output:</strong></p>
<ql-code-block output="">
[core]
project = qwiklabs-gcp-44776a13dea667a6
</ql-code-block>
<ql-infobox><strong>Note: </strong>
  Full documentation of <strong>gcloud</strong> is available in the
  <a href="https://cloud.google.com/sdk/gcloud" target="_blank">
    gcloud CLI overview guide
  </a>.
</ql-infobox>
<h3>Basic Linux Commands</h3>
<p>Below you will find a reference list of a few very basic Linux commands which may be included in the instructions or code blocks for this lab.</p>
<table>

<tr>
<th>Command --&gt;</th>
<th>Action</th>
<th>.</th>
<th>Command --&gt;</th>
<th>Action</th>
</tr>


<tr>
<td>
<strong>mkdir</strong> (<em>make directory</em>)</td>
<td>create a new folder</td>
<td>.</td>
<td>
<strong>cd</strong> (<em>change directory</em>)</td>
<td>change location to another folder</td>
</tr>
<tr>
<td>
<strong>ls</strong> (<em>list</em> )</td>
<td>list files and folders in the directory</td>
<td>.</td>
<td>
<strong>cat</strong> (<em>concatenate</em>)</td>
<td>read contents of a file without using an editor</td>
</tr>
<tr>
<td><strong>apt-get update</strong></td>
<td>update package manager library</td>
<td>.</td>
<td><strong>ping</strong></td>
<td>signal to test reachability of a host</td>
</tr>
<tr>
<td>
<strong>mv</strong> (<em>move</em> )</td>
<td>moves a file</td>
<td>.</td>
<td>
<strong>cp</strong> (<em>copy</em>)</td>
<td>makes a file copy</td>
</tr>
<tr>
<td>
<strong>pwd</strong> (<em>present working directory</em> )</td>
<td>returns your current location</td>
<td>.</td>
<td>
<strong>sudo</strong> (<em>super user do</em>)</td>
<td>gives higher administration privileges</td>
</tr>

</table>
<h2 id="step3">Task 1. Configure the environment</h2>
<p>Cloud Run requires some environmental configuration before we begin. In this section, you enable the Cloud Run API and set the compute region.</p>
<ol>
<li>Enable Cloud Run API:</li>
</ol>
<ql-code-block language="bash">
gcloud services enable run.googleapis.com
</ql-code-block>
<p>If you are asked to authorize the use of your credentials, do so.</p>
<p>You should then see a successful message similar to this one:</p>
<ql-code-block output="">
Operation "operations/acf.cc11852d-40af-47ad-9d59-477a12847c9e" finished successfully.
</ql-code-block>
<ql-infobox><strong>Note: </strong>You can also enable the API using the <strong>APIs &amp; Services </strong>section of the console.</ql-infobox>
<ol start="2">
<li>
<p>Set the compute and run regions. Cloud Run requires knowledge of the region in which it will be deployed:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud config set compute/region us-central1
gcloud config set run/region us-central1
</ql-code-block>
<ol start="3">
<li>
<p>Create a LOCATION environment variable:</p>
</li>
</ol>
<ql-code-block language="bash">
LOCATION="us-central1"
</ql-code-block>
<p>This lab also requires the <code>gcloud</code> command line tool for Google Cloud Platform. However, the <code>gcloud</code> command line tool comes pre-installed on Cloud Shell so we will not need to configure it in this lab.</p>
<h2 id="step4">Task 2. Write a simple application</h2>
<p>For this lab, we will create a simple Cloud Run Python "Hello, World" app and  deploy it as a Cloud Run service in the us-central1 region. This simple app will become the target for an external HTTP load balancer which will use a serverless NEG backend to route requests to that service.</p>
<ol>
<li>
<p>In Cloud Shell create a new directory named <code>helloworld</code>, then move your view into that directory:</p>
</li>
</ol>
<ql-code-block language="bash">
mkdir helloworld &amp;&amp; cd helloworld
</ql-code-block>
<p>Next you'll be creating and editing files.</p>
<ol start="2">
<li>To edit files, use <code>vi</code>, <code>emac</code>, <code>nano</code> or the Cloud Shell Editor by clicking on the pencil icon in Cloud Shell ("Open Editor").</li>
</ol>
<p><img alt="The Open Editor button highlighted in the UI." src="https://cdn.qwiklabs.com/SrFpOY07s1soXJgXIfQ%2F3Sa3MW6awbhM9gzkACKBAjU%3D"></p>
<p>When you open the Cloud Shell Editor, it will show your user's home directory, NOT the directory you are seeing in the terminal.</p>
<ol start="3">
<li>
<p>Be sure to click on the "helloworld" folder to be certain you are in the correct directory before you create the following two files.</p>
</li>
<li>
<p>Create a <code>main.py</code> file, then add the following content to it:</p>
</li>
</ol>
<ql-code-block language="plaintext">
import os
from flask import Flask
app = Flask(__name__)
@app.route("/")
def hello_world():
    name = os.environ.get("NAME", "World")
    return "Hello {}!".format(name)
if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=int(os.environ.get("PORT", 8080)))
</ql-code-block>
<p>This code responds to requests on port 8080 with a "Hello World" greeting.</p>
<p>Your app is now finished and ready to be containerized and uploaded to Container Registry.</p>
<ql-infobox><strong>Note: </strong>You can use languages other than Python to get started with Cloud Run. You can find instructions for Go, Python, Java, PHP, Ruby, Shell scripts, and others in the <a href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy" target="_blank">Cloud Run documentation</a>.</ql-infobox>
<h2 id="step5">Task 3.  Containerize your app and upload it to Container Registry (Artifact Registry)</h2>
<ol>
<li>
<p>To containerize the sample app you just made, create a new file named <code>Dockerfile</code> in the same directory as the <code>main.py</code> file, and add the following content:</p>
</li>
</ol>
<ql-code-block language="bash">
# Use the official lightweight Python image.
# https://hub.docker.com/_/python
FROM python:3.9-slim
# Allow statements and log messages to immediately appear in the Knative logs
    ENV PYTHONUNBUFFERED True
# Copy local code to the container image.
ENV APP_HOME /app
WORKDIR $APP_HOME
COPY . ./
# Install production dependencies.
RUN pip install Flask gunicorn
# Run the web service on container startup. Here we use the gunicorn
# webserver, with one worker process and 8 threads.
# For environments with multiple CPU cores, increase the number of workers
# to be equal to the cores available.
# Timeout is set to 0 to disable the timeouts of the workers to allow Cloud Run to handle instance scaling.
CMD exec gunicorn --bind :$PORT --workers 1 --threads 8 --timeout 0 main:app
</ql-code-block>
<p>This Python Dockerfile starts a Gunicorn web server which listens on the port defined by the <code>PORT</code> environmental variable set in the main.py file (port 8080).</p>
<ol start="2">
<li>
<p>Now, build your container image using Cloud Build, by running the following command <strong>from the directory containing the Dockerfile</strong>:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud builds submit --tag gcr.io/$GOOGLE_CLOUD_PROJECT/helloworld
</ql-code-block>
<p>Upon success, you will see a SUCCESS message containing the image name (<code>gcr.io/PROJECT-ID/helloworld</code>). The image is now stored in Container Registry and can be deployed in the next task.</p>
<ql-infobox><strong>Note</strong>: You can ignore any warning while building the container image using Cloud Build.</ql-infobox>
<h2 id="step6">Task 4.  Deploy your container to Cloud Run</h2>
<p>Now that we have our containerized image, we will need to use the <code>gcloud</code> command below to deploy it to Cloud Run.</p>
<ol>
<li>
<p>Replace PROJECT-ID with your GCP project ID. You can view your project ID by running the command <code>gcloud config get-value project.</code></p>
</li>
</ol>
<ql-code-block language="bash">
gcloud run deploy --image gcr.io/$GOOGLE_CLOUD_PROJECT/helloworld
</ql-code-block>
<ol start="2">
<li>
<p>The API should already be enabled, but if you are prompted to enable the API, Reply <code>y</code>.</p>
</li>
<li>
<p>You will then be prompted for the service name: press <strong>Enter</strong> to accept the default name, <code>helloworld</code>.</p>
</li>
<li>
<p>If prompted for region: in this case, select us-central1.</p>
</li>
<li>
<p>You will be prompted to allow unauthenticated invocations: respond <code>y</code>.</p>
</li>
</ol>
<p>Wait a few moments until the deployment is complete. Upon success, the command line displays the service URL.</p>
<ol start="6">
<li>
<p>Visit your deployed container by opening the service URL in a web browser.</p>
</li>
</ol>
<h2 id="step7">Task 5.  Reserve an external IP address</h2>
<p>Now that your services are up and running, you need to set up a global static external IP address that your customers use to reach your load balancer.</p>
<p>A static external IP address provides a single address to point your serverless app to. Reserving an IP address would also be essential if you were using a custom domain for your serverless app.</p>
<ol>
<li>
<p>Use the following command to reserve your static IP address:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute addresses create example-ip \
    --ip-version=IPV4 \
    --global
</ql-code-block>
<ol start="2">
<li>
<p>To display the IP address that was just reserved, use:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute addresses describe example-ip \
    --format="get(address)" \
    --global
</ql-code-block>
<ol start="3">
<li>
<p>Note this IP address, because you will need it later.</p>
</li>
</ol>
<h2 id="step8">Task 6.  Create the external HTTP load balancer</h2>
<p>Load balancers use a serverless Network Endpoint Group (NEG) backend to direct requests to a serverless Cloud Run service.<br>
So, let's first create our serverless NEG for our serverless Python app created earlier in this lab.</p>
<ol>
<li>
<p>To create a serverless NEG with a Cloud Run service, enter the following in Cloud Shell:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute network-endpoint-groups create myneg \
   --region=$LOCATION \
   --network-endpoint-type=serverless  \
   --cloud-run-service=helloworld
</ql-code-block>
<ol start="2">
<li>
<p>Now, we need to create a backend service:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute backend-services create mybackendservice \
    --global
</ql-code-block>
<ol start="3">
<li>
<p>And then add the serverless NEG as a backend to this backend service:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute backend-services add-backend mybackendservice \
    --global \
    --network-endpoint-group=myneg \
    --network-endpoint-group-region=$LOCATION
</ql-code-block>
<ol start="4">
<li>
<p>Finally, create a URL map to route incoming requests to the backend service:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute url-maps create myurlmap \
    --default-service mybackendservice
</ql-code-block>
<p>If you had more than one backend service, you could use host rules to direct requests to different services based on the host name, or you could set up path matchers to direct requests to different services based on the request path.  None of this is necessary here because we have only created one backend service for this lab.</p>
<ol start="5">
<li>
<p>Now, create a target HTTP(S) proxy to route requests to your URL map:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute target-http-proxies create mytargetproxy \
    --url-map=myurlmap
</ql-code-block>
<ol start="6">
<li>
<p>Create a global forwarding rule to route incoming requests to the proxy:</p>
</li>
</ol>
<ql-code-block language="bash">
gcloud compute forwarding-rules create myforwardingrule \
    --address=example-ip \
    --target-http-proxy=mytargetproxy \
    --global \
    --ports=80
</ql-code-block>
<h2 id="step9">Task 7.  Test your external HTTP load balancer</h2>
<ul>
<li>
<p>You can test your HTTP load balancer by going to <code>http://IP_ADDRESS</code>, where  <code>IP_ADDRESS</code> is the load balancer's IP address you reserved earlier in this lab. When you open this URL, you should see the helloworld service homepage.</p>
</li>
</ul>
<h2 id="step10">Congratulations!</h2>
<p>Over this course of this lab, you have learned how to use an HTTP global load balancer with a Cloud Run application.</p>
<ul>
<li>
<p>Deploy a simple Cloud Run service</p>
</li>
<li>
<p>Expose this service to the internet using an external IP address</p>
</li>
<li>
<p>Create a global HTTP load balancer for the service</p>
</li>
</ul>
<h3>Next steps / Learn more</h3>
<p>Follow the  <a href="https://www.youtube.com/watch?v=s2TIWIzCftM&amp;list=PLIivdWyY5sqJwq_pgOxcHzusWjXDVCEiX" target="_blank">Serverless Expeditions video series</a> to learn more about how to utilise these products within your project.</p>
<ul>
<li>Cloud Run</li>
<li>Cloud Build</li>
<li>Cloud Functions</li>
</ul>
<p><strong>Manual Last Updated October 4, 2022</strong></p>
<p><strong>Lab Last Tested June 30, 2021</strong></p>
<p>Copyright 2022 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>

</div>
</div>


<div class='lab-content__end-lab-button js-end-lab-button-container hidden'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
</div>
<div aria-label='Lab Table of Contents' class='outline-container' id='js-outline-container' role='navigation'>
<ul class='lab-content__outline js-lab-content-outline'>
<li><a href="#step1">Overview</a></li><li><a href="#step2">Setup and requirements</a></li><li><a href="#step3">Task 1. Configure the environment</a></li><li><a href="#step4">Task 2. Write a simple application</a></li><li><a href="#step5">Task 3.  Containerize your app and upload it to Container Registry (Artifact Registry)</a></li><li><a href="#step6">Task 4.  Deploy your container to Cloud Run</a></li><li><a href="#step7">Task 5.  Reserve an external IP address</a></li><li><a href="#step8">Task 6.  Create the external HTTP load balancer</a></li><li><a href="#step9">Task 7.  Test your external HTTP load balancer</a></li><li><a href="#step10">Congratulations!</a></li>
</ul>
</div>
</ql-drawer-content>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<ql-snackbar id='alert-snackbar'></ql-snackbar>



</div>
</main>

<span class='hidden' id='flash-sibling-before'></span>
<ql-snackbar></ql-snackbar>

<script data-glue-cookie-notification-bar-category='2B' src='https://www.gstatic.com/glue/cookienotificationbar/cookienotificationbar.min.js'></script>

<ql-dialog headline='Score Details' icon='task_alt' id='jupyter-feedback-modal'>
<iframe id='jupyter-feedback-frame' srcdoc='' title='Jupyter Feedback'></iframe>
</ql-dialog>

<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='modal-content mdl-shadow--24dp'>
<div class='modal-body'>
<p class='l-mbm'>
Cloud Run allows you to specify which revisions should receive traffic and to specify traffic percentages that are received by a revision.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
60m access
&middot;
60m completion
</p>
<p class='small-label l-mbs'>
<strong>AWS Region:</strong>
[] <strong></strong>
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>introductory</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://googlecoursera.qwiklabs.com/catalog_lab/3815">https://googlecoursera.qwiklabs.com/catalog_lab/3815</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix' tabindex='-1' title='modal'></iframe>
</div>
<ql-dialog headline='How satisfied are you with this lab?&lt;span aria-hidden=&quot;true&quot;&gt;*&lt;/span&gt;' id='lab-review-dialog'>
<form class="simple_form js-lab-review-form" id="new_lab_review" action="/lab_reviews" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" autocomplete="off" /><div aria-labelledby='lab-review-dialog' aria-required='true' aria-valuemax='5' aria-valuemin='0' aria-valuenow='0' class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='0' id='lab-review-rateit' role='slider' tabindex='0'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" value="12197799" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" value="3815" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" autocomplete="off" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" autocomplete="off" type="hidden" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Additional Comments</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</form><ql-button disabled id='submit' label='Submit' slot='action' text></ql-button>
</ql-dialog>

<ql-dialog headline='All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?' icon='error_outline' id='js-lab-are-you-sure-dialog'>
<ql-button id='js-are-you-sure-button' label='Submit' slot='action' text></ql-button>
</ql-dialog>


<script>
  $(function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.chat.init();
  ql.jumpContent.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabReviewTranslations( {"star_amount_1":"1 of 5 stars","star_amount_2":"2 of 5 stars","star_amount_3":"3 of 5 stars","star_amount_4":"4 of 5 stars","star_amount_5":"5 of 5 stars"} )
  ql.labAssessment.init();
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

